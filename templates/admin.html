{% extends "base_layout.html" %}
{% set active_page = 'admin' %}

{% block title %}Administration - Nmap IA{% endblock %}

{% block extra_css %}
<style>
    .admin-container {
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
    }

    .admin-header {
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .admin-title h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }

    .admin-title p {
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.1rem;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .stat-card {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .stat-card:hover {
        transform: translateY(-10px);
        border-color: var(--primary);
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--primary-gradient);
        opacity: 0.8;
    }

    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: white;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: rgba(255, 255, 255, 0.6);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.9rem;
    }

    /* Tabs */
    .admin-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
        scrollbar-width: thin;
    }

    .admin-tab {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        color: white;
        padding: 1rem 2rem;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
    }

    .admin-tab:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
    }

    .admin-tab.active {
        background: var(--primary-gradient);
        border-color: transparent;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .tab-content {
        display: none;
        animation: fadeIn 0.5s ease-out;
    }

    .tab-content.active {
        display: block;
    }

    /* Panels */
    .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        padding: 2.5rem;
        margin-bottom: 2rem;
    }

    .panel-header {
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .panel-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    /* Charts */
    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 2rem;
    }

    .chart-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 1.5rem;
    }

    .chart-card h3 {
        color: white;
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
        font-weight: 600;
    }

    /* Tables */
    .table-container {
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        color: white;
    }

    th {
        text-align: left;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        font-weight: 600;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 1px;
    }

    td {
        padding: 1.25rem 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    tr:hover td {
        background: rgba(255, 255, 255, 0.02);
    }

    /* Forms */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.75rem;
        color: rgba(255, 255, 255, 0.8);
        font-weight: 500;
        font-size: 0.95rem;
    }

    .form-input, .form-textarea, .form-select {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        border-radius: 12px;
        padding: 1rem;
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
        outline: none;
        border-color: var(--primary);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }

    .form-textarea {
        min-height: 120px;
        resize: vertical;
    }

    /* Badges */
    .badge {
        padding: 0.4rem 0.8rem;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: capitalize;
    }

    .badge-low { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.3); }
    .badge-moderate { background: rgba(234, 179, 8, 0.2); color: #facc15; border: 1px solid rgba(234, 179, 8, 0.3); }
    .badge-high { background: rgba(249, 115, 22, 0.2); color: #fb923c; border: 1px solid rgba(249, 115, 22, 0.3); }
    .badge-critical { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }

    /* Search Box */
    .search-wrapper {
        position: relative;
        max-width: 400px;
    }

    .search-wrapper i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.4);
    }

    .search-input {
        padding-left: 2.8rem !important;
    }

    /* Messages */
    .alert {
        padding: 1rem 1.5rem;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        animation: slideInRight 0.3s ease-out;
    }

    .alert-success {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.2);
        color: #4ade80;
    }

    .alert-error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        color: #f87171;
    }

    @media (max-width: 768px) {
        .admin-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .charts-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
    <header class="admin-header">
        <div class="admin-title">
            <h1>Tableau de Bord</h1>
            <p>Gérez la base de connaissances et suivez l'activité de l'IA.</p>
        </div>
        <div class="admin-actions">
            <button class="glass-btn secondary" onclick="loadStats()">
                <i class="fas fa-sync-alt"></i> Rafraîchir
            </button>
        </div>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-virus"></i></div>
            <div class="stat-value" id="stat-diseases">-</div>
            <div class="stat-label">Maladies</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-pills"></i></div>
            <div class="stat-value" id="stat-drugs">-</div>
            <div class="stat-label">Médicaments</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-user-md"></i></div>
            <div class="stat-value" id="stat-consultations">-</div>
            <div class="stat-label">Consultations</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-comments"></i></div>
            <div class="stat-value" id="stat-messages">-</div>
            <div class="stat-label">Messages</div>
        </div>
    </div>

    <div class="admin-tabs">
        <button class="admin-tab active" onclick="showTab(event, 'dashboard')">
            <i class="fas fa-chart-line"></i> Dashboard
        </button>
        <button class="admin-tab" onclick="showTab(event, 'diseases')">
            <i class="fas fa-list"></i> Maladies
        </button>
        <button class="admin-tab" onclick="showTab(event, 'drugs')">
            <i class="fas fa-capsules"></i> Médicaments
        </button>
        <button class="admin-tab" onclick="showTab(event, 'add-disease')">
            <i class="fas fa-plus-circle"></i> Ajouter Maladie
        </button>
        <button class="admin-tab" onclick="showTab(event, 'add-drug')">
            <i class="fas fa-plus-square"></i> Ajouter Médicament
        </button>
    </div>

    <!-- Tab Dashboard -->
    <div id="dashboard" class="tab-content active">
        <div class="glass-panel">
            <div class="panel-header">
                <h2 class="panel-title"><i class="fas fa-analytics"></i> Analyse de l'Activité</h2>
            </div>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Consultations par jour</h3>
                    <canvas id="consultationsChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Maladies les plus recherchées</h3>
                    <canvas id="diseasesChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Répartition par gravité</h3>
                    <canvas id="severityChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Activité mensuelle</h3>
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Maladies -->
    <div id="diseases" class="tab-content">
        <div class="glass-panel">
            <div class="panel-header">
                <h2 class="panel-title"><i class="fas fa-virus"></i> Liste des Maladies</h2>
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-diseases" class="form-input search-input" placeholder="Rechercher une maladie..." onkeyup="filterDiseases()">
                </div>
            </div>
            <div class="table-container">
                <table id="diseases-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Description</th>
                            <th>Gravité</th>
                            <th>Symptômes</th>
                        </tr>
                    </thead>
                    <tbody id="diseases-tbody">
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 3rem;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; opacity: 0.5;"></i>
                                <p style="margin-top: 1rem;">Chargement des données...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tab Médicaments -->
    <div id="drugs" class="tab-content">
        <div class="glass-panel">
            <div class="panel-header">
                <h2 class="panel-title"><i class="fas fa-capsules"></i> Liste des Médicaments</h2>
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-drugs" class="form-input search-input" placeholder="Rechercher un médicament..." onkeyup="filterDrugs()">
                </div>
            </div>
            <div class="table-container">
                <table id="drugs-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Catégorie</th>
                            <th>Dosage</th>
                            <th>Interactions</th>
                        </tr>
                    </thead>
                    <tbody id="drugs-tbody">
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 3rem;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; opacity: 0.5;"></i>
                                <p style="margin-top: 1rem;">Chargement des données...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tab Ajouter Maladie -->
    <div id="add-disease" class="tab-content">
        <div class="glass-panel">
            <div class="panel-header">
                <h2 class="panel-title"><i class="fas fa-plus-circle"></i> Ajouter une Nouvelle Maladie</h2>
            </div>
            <div id="disease-message"></div>
            <form onsubmit="addDisease(event)" class="form-grid">
                <div class="form-group">
                    <label>Nom de la maladie *</label>
                    <input type="text" id="disease-name" class="form-input" placeholder="Ex: Grippe" required>
                </div>
                <div class="form-group">
                    <label>Gravité *</label>
                    <select id="disease-severity" class="form-select" required>
                        <option value="faible">Faible</option>
                        <option value="modérée">Modérée</option>
                        <option value="élevée">Élevée</option>
                        <option value="critique">Critique</option>
                    </select>
                </div>
                <div class="form-group full-width">
                    <label>Description *</label>
                    <textarea id="disease-description" class="form-textarea" placeholder="Description détaillée de la pathologie..." required></textarea>
                </div>
                <div class="form-group">
                    <label>Symptômes (séparés par des virgules) *</label>
                    <textarea id="disease-symptoms" class="form-textarea" placeholder="fièvre, toux, fatigue" required></textarea>
                </div>
                <div class="form-group">
                    <label>Recommandations (une par ligne) *</label>
                    <textarea id="disease-recommendations" class="form-textarea" placeholder="Boire beaucoup d'eau&#10;Se reposer" required></textarea>
                </div>
                <div class="form-group full-width">
                    <button type="submit" class="glass-btn primary">
                        <i class="fas fa-save"></i> Enregistrer la Maladie
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tab Ajouter Médicament -->
    <div id="add-drug" class="tab-content">
        <div class="glass-panel">
            <div class="panel-header">
                <h2 class="panel-title"><i class="fas fa-plus-square"></i> Ajouter un Nouveau Médicament</h2>
            </div>
            <div id="drug-message"></div>
            <form onsubmit="addDrug(event)" class="form-grid">
                <div class="form-group">
                    <label>Nom du médicament *</label>
                    <input type="text" id="drug-name" class="form-input" placeholder="Ex: Paracétamol" required>
                </div>
                <div class="form-group">
                    <label>Catégorie *</label>
                    <input type="text" id="drug-category" class="form-input" placeholder="Ex: Antalgique" required>
                </div>
                <div class="form-group full-width">
                    <label>Dosage *</label>
                    <textarea id="drug-dosage" class="form-textarea" placeholder="Ex: 500mg 3 fois par jour" required></textarea>
                </div>
                <div class="form-group">
                    <label>Interactions (séparées par des virgules)</label>
                    <textarea id="drug-interactions" class="form-textarea" placeholder="alcool, anticoagulants"></textarea>
                </div>
                <div class="form-group">
                    <label>Contre-indications (séparées par des virgules)</label>
                    <textarea id="drug-contraindications" class="form-textarea" placeholder="grossesse, insuffisance rénale"></textarea>
                </div>
                <div class="form-group full-width">
                    <button type="submit" class="glass-btn primary">
                        <i class="fas fa-save"></i> Enregistrer le Médicament
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const API_URL = window.location.origin;
    let allDiseases = [];
    let allDrugs = [];
    let consultationsChart, diseasesChart, severityChart, activityChart;

    // Initialisation des couleurs pour Chart.js
    Chart.defaults.color = 'rgba(255, 255, 255, 0.7)';
    Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

    // Charger les statistiques
    async function loadStats() {
        try {
            const response = await fetch(`${API_URL}/api/statistics`);
            const data = await response.json();

            document.getElementById('stat-diseases').textContent = data.statistics.total_diseases;
            document.getElementById('stat-drugs').textContent = data.statistics.total_drugs;
            document.getElementById('stat-consultations').textContent = data.statistics.total_consultations;
            document.getElementById('stat-messages').textContent = data.statistics.total_messages;
        } catch (error) {
            console.error('Erreur chargement stats:', error);
        }
    }

    // Charger les maladies
    async function loadDiseases() {
        try {
            const response = await fetch(`${API_URL}/api/admin/diseases`);
            const data = await response.json();
            allDiseases = data.diseases;
            displayDiseases(allDiseases);
        } catch (error) {
            console.error('Erreur chargement maladies:', error);
        }
    }

    // Afficher les maladies
    function displayDiseases(diseases) {
        const tbody = document.getElementById('diseases-tbody');
        if (diseases.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Aucune maladie trouvée</td></tr>';
            return;
        }

        tbody.innerHTML = diseases.map(disease => `
            <tr>
                <td><strong>${disease.name}</strong></td>
                <td><div style="max-width: 400px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${disease.description}</div></td>
                <td><span class="badge badge-${getSeverityClass(disease.severity)}">${disease.severity}</span></td>
                <td>${disease.symptoms.slice(0, 3).join(', ')}${disease.symptoms.length > 3 ? '...' : ''}</td>
            </tr>
        `).join('');
    }

    // Charger les médicaments
    async function loadDrugs() {
        try {
            const response = await fetch(`${API_URL}/api/admin/drugs`);
            const data = await response.json();
            allDrugs = data.drugs;
            displayDrugs(allDrugs);
        } catch (error) {
            console.error('Erreur chargement médicaments:', error);
        }
    }

    // Afficher les médicaments
    function displayDrugs(drugs) {
        const tbody = document.getElementById('drugs-tbody');
        if (drugs.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Aucun médicament trouvé</td></tr>';
            return;
        }

        tbody.innerHTML = drugs.map(drug => `
            <tr>
                <td><strong>${drug.name}</strong></td>
                <td>${drug.category}</td>
                <td>${drug.dosage}</td>
                <td>${drug.interactions.join(', ') || '<span style="opacity: 0.5;">Aucune</span>'}</td>
            </tr>
        `).join('');
    }

    // Filtrer les maladies
    function filterDiseases() {
        const search = document.getElementById('search-diseases').value.toLowerCase();
        const filtered = allDiseases.filter(d =>
            d.name.toLowerCase().includes(search) ||
            d.description.toLowerCase().includes(search)
        );
        displayDiseases(filtered);
    }

    // Filtrer les médicaments
    function filterDrugs() {
        const search = document.getElementById('search-drugs').value.toLowerCase();
        const filtered = allDrugs.filter(d =>
            d.name.toLowerCase().includes(search) ||
            d.category.toLowerCase().includes(search)
        );
        displayDrugs(filtered);
    }

    // Ajouter une maladie
    async function addDisease(event) {
        event.preventDefault();

        const name = document.getElementById('disease-name').value;
        const description = document.getElementById('disease-description').value;
        const symptoms = document.getElementById('disease-symptoms').value.split(',').map(s => s.trim());
        const recommendations = document.getElementById('disease-recommendations').value.split('\n').filter(r => r.trim());
        const severity = document.getElementById('disease-severity').value;

        try {
            const response = await fetch(`${API_URL}/api/admin/diseases`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, description, symptoms, recommendations, severity })
            });

            const data = await response.json();

            if (data.success) {
                showAlert('disease-message', 'Maladie ajoutée avec succès!', 'success');
                event.target.reset();
                loadDiseases();
                loadStats();
            } else {
                showAlert('disease-message', 'Erreur: ' + data.error, 'error');
            }
        } catch (error) {
            showAlert('disease-message', 'Erreur: ' + error.message, 'error');
        }
    }

    // Ajouter un médicament
    async function addDrug(event) {
        event.preventDefault();

        const name = document.getElementById('drug-name').value;
        const category = document.getElementById('drug-category').value;
        const dosage = document.getElementById('drug-dosage').value;
        const interactions = document.getElementById('drug-interactions').value.split(',').map(s => s.trim()).filter(s => s);
        const contraindications = document.getElementById('drug-contraindications').value.split(',').map(s => s.trim()).filter(s => s);

        try {
            const response = await fetch(`${API_URL}/api/admin/drugs`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, category, dosage, interactions, contraindications })
            });

            const data = await response.json();

            if (data.success) {
                showAlert('drug-message', 'Médicament ajouté avec succès!', 'success');
                event.target.reset();
                loadDrugs();
                loadStats();
            } else {
                showAlert('drug-message', 'Erreur: ' + data.error, 'error');
            }
        } catch (error) {
            showAlert('drug-message', 'Erreur: ' + error.message, 'error');
        }
    }

    // Afficher une alerte
    function showAlert(elementId, message, type) {
        const element = document.getElementById(elementId);
        const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
        element.innerHTML = `
            <div class="alert alert-${type}">
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            </div>
        `;
        setTimeout(() => element.innerHTML = '', 5000);
    }

    // Changer de tab
    function showTab(event, tabName) {
        document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        event.currentTarget.classList.add('active');
        document.getElementById(tabName).classList.add('active');

        if (tabName === 'dashboard') {
            loadCharts();
        }
    }

    // Classe de gravité
    function getSeverityClass(severity) {
        const map = {
            'faible': 'low',
            'modérée': 'moderate',
            'élevée': 'high',
            'critique': 'critical'
        };
        return map[severity] || 'moderate';
    }

    // Initialisation
    window.onload = function () {
        loadStats();
        loadDiseases();
        loadDrugs();
        loadCharts();
    };

    // Charts implementation
    function loadCharts() {
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        font: { size: 12 }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.05)' },
                    ticks: { font: { size: 11 } }
                },
                x: {
                    grid: { display: false },
                    ticks: { font: { size: 11 } }
                }
            }
        };

        // Consultations Chart
        const ctx1 = document.getElementById('consultationsChart');
        if (ctx1 && !consultationsChart) {
            ctx1.parentElement.style.height = '300px';
            consultationsChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                    datasets: [{
                        label: 'Consultations',
                        data: [12, 19, 15, 25, 22, 18, 20],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: { ...commonOptions.plugins, legend: { display: false } }
                }
            });
        }

        // Diseases Chart
        const ctx2 = document.getElementById('diseasesChart');
        if (ctx2 && !diseasesChart) {
            ctx2.parentElement.style.height = '300px';
            diseasesChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Grippe', 'Migraine', 'Gastro', 'COVID-19', 'Angine'],
                    datasets: [{
                        label: 'Recherches',
                        data: [45, 32, 28, 25, 20],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                            'rgba(20, 184, 166, 0.8)',
                            'rgba(34, 197, 94, 0.8)'
                        ],
                        borderRadius: 8
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: { ...commonOptions.plugins, legend: { display: false } }
                }
            });
        }

        // Severity Chart
        const ctx3 = document.getElementById('severityChart');
        if (ctx3 && !severityChart) {
            ctx3.parentElement.style.height = '300px';
            severityChart = new Chart(ctx3, {
                type: 'doughnut',
                data: {
                    labels: ['Faible', 'Modérée', 'Élevée', 'Critique'],
                    datasets: [{
                        data: [15, 35, 30, 5],
                        backgroundColor: [
                            '#22c55e',
                            '#eab308',
                            '#f97316',
                            '#ef4444'
                        ],
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: { x: { display: false }, y: { display: false } },
                    cutout: '70%'
                }
            });
        }

        // Activity Chart
        const ctx4 = document.getElementById('activityChart');
        if (ctx4 && !activityChart) {
            ctx4.parentElement.style.height = '300px';
            activityChart = new Chart(ctx4, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin'],
                    datasets: [{
                        label: 'Consultations',
                        data: [150, 200, 180, 220, 250, 280],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Messages',
                        data: [300, 350, 320, 400, 450, 500],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: commonOptions
            });
        }
    }
</script>
{% endblock %}
